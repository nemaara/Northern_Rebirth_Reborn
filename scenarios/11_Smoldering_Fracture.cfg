#textdomain wesnoth-nrr

[scenario]
    id=11_Smoldering_Fracture
    name= _ "Smoldering Fracture"
    map_file=11_Smoldering_Fracture.map
    
    # you can lose when more drakes show up
    {TURNS 90 90 90}

    next_scenario=11x_Victory_or_Death
    victory_when_enemies_defeated=yes
    {XP_MODIFIER_NRR}

    # these are now constants
    {NRR_LOAD_RESOURCES}
    {ENABLE_DWARVISH_RUNESMITH}
    {NRR_ENCHANTING_SYSTEM}
    [load_resource]
        id=nrr_rune_info_help
    [/load_resource]

    # music playlist
    {DEFAULT_MUSIC_PLAYLIST}

    # adjusted schedule

    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {DAWN}
    # favour drakes
    {MORNING}
    {MIDDAY}
    {MIDDAY}
    {AFTERNOON}

    # time area
    # underground
    [time_area]
        x=55-89,17,   18,   19,   20,   21,   22,   23,24-27,   28,   29,   30,   31,   32,   33,   34
        y= 0-67,67,65-67,64-67,63-67,63-67,63-67,63-67,62-67,61-67,62-67,61-67,62-67,63-67,65-67,66-67
        {UNDERGROUND}
    [/time_area]
    # indoors
    [time_area]
        x="5,6,7,8,9,10,11,12,13,14,14,15,16,17,18,19,20,21,21,22,23,24,24,25,26,27,28,29,30,30,31,32,33,34,35,36,37,38,39,40,40,14,21,24,30"
        y="14-19,13-20,14-22,13-23,13-25,13-25,13-26,12-26,13-27,12-13,15-27,12-28,12-28,13-28,12-28,12-29,11-28,11-18,20-29,11-29,11-29,11-18,20-29,12-29,11-28,12-29,11-29,12-29,12-13,15-29,13-30,12-29,13-29,13-29,13-29,13-28,13-28,13-27,15-27,19-21,23-26,14,19,19,14"
        {INDOORS}
    [/time_area]

    # Tallin
    [side]
        side=1
        controller=human
        {CHARACTER_STATS_TALLIN}
        {FLAG_VARIANT knalgan}
        team_name="player"
        user_team_name= _ "Knalgan Alliance"
        shroud=yes
        fog=no
        share_vision=all
        # biggest battle scenario
        # go wild
        {GOLD 750 620 500}
        {INCOME 14 12 10}
        recruit={KNALGAN_ALLIANCE_RECRUIT_LIST_FULL}
    [/side]

    # zorfu
    [side]
        side=2
        controller=ai
        persistent=yes
        save_id=Zorfu
        {WITHERVEIN_ORCS}
        {CHARACTER_STATS_ZORFU}
        {FLAG_VARIANT6 ragged}
        team_name="player"
        user_team_name= _ "Withervein Orcs"
        shroud=yes
        fog=no
        share_vision=all

        # biggest battle scenario
        # go wild
        {GOLD 750 620 500}
        {INCOME 14 16 20}

        recruit={ORC_CLAN_WITHERVEIN_RECRUIT_LIST}
        {CHAOTIC_AI_PARAMS}
    [/side]

    # Hamel
    [side]
        side=3
        controller=ai
        {CHARACTER_STATS_HAMEL}
        {FLAG_VARIANT knalgan}
        team_name=player
        user_team_name= _ "Knalga"
        {KNALGAN_ALLIANCE_DWAVRES}
        shroud=yes
        fog=no
        share_vision=all
        {GOLD 750 620 500}
        {INCOME 14 12 20}
        recall_cost={ON_DIFFICULTY 10 12 15}
        recruit={KNALGAN_ALLIANCE_DWARVES_RECRUITS}
        {NEUTRAL_AI_PARAMS}
    [/side]

    # prevent ally from going overboard
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Steelclad" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Thunderguard" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Pathfinder" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Stalwart" {ON_DIFFICULTY 2 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Berserker" {ON_DIFFICULTY 2 2 2}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Fighter" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Thunderer" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Scout" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Guardsman" {ON_DIFFICULTY 2 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Dwarvish Ulfserker" {ON_DIFFICULTY 2 2 2}}

    # Masked Dwarves
    [side]
        side=4
        controller=ai
        id=Ancatil
        name= _ "Masked Dwarf"
        type=Dwarvish Masked Sentinel
        canrecruit=yes
        unrenamable=yes
        [modifications]
            # make him a pain to dispatch
            {TRAIT_ELITE}
            {TRAIT_STRONG}
        [/modifications]

        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        team_name=karrag
        user_team_name= _ "Masked Dwarves"

        {GOLD 420 540 660}
        {INCOME 6 8 10}
        recruit={KAL_KARTHA_MASKED_DWARVES_ELITES}
        village_gold=1
        village_support={ON_DIFFICULTY 4 6 8}
        {NEUTRAL_AI_PARAMS}
    [/side]

    # limit recruits
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Lord" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Dragonguard" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Sentinel" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Berserker" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Fighter" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Thunderer" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Guardsman" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Ulfserker" {ON_DIFFICULTY 3 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Dwarvish Masked Stalwart" {ON_DIFFICULTY 4 4 5}}

    # saurians
    [side]
        side=5
        controller=ai
        id=Xerxix
        name= _ "Xerxix"
        type="Saurian Prophet"
        [modifications]
            {TRAIT_ELITE}
            {TRAIT_QUICK}
        [/modifications]
        canrecruit=yes
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Saurians"

        {GOLD 420 540 660}
        {INCOME 6 8 10}

        # the full set
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Oracle, Saurian Spearthrower, Saurian Ambusher, Saurian Soothsayer, Saurian Flanker, Saurian Javelineer,Saurian Seer,Saurian Prophet"
        {CHAOTIC_AI_PARAMS}
        [ai]
            # please no suicide
            passive_leader=yes
        [/ai]
    [/side]

    # make saurians be mostly level 2
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Skirmisher" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Augur" {ON_DIFFICULTY 3 4 5}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Javelineer" {ON_DIFFICULTY 4 4 5}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Flanker" {ON_DIFFICULTY 4 4 5}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Prophet" {ON_DIFFICULTY 5 6 7}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Seer" {ON_DIFFICULTY 3 3 4}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Ambusher" {ON_DIFFICULTY 4 4 5}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Spearthrower" {ON_DIFFICULTY 4 4 5}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Soothsayer" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Saurian Oracle" {ON_DIFFICULTY 5 6 7}}

    # Drakes
    [side]
        side=6
        controller=ai
        # if you see a drake with double names
        # it's because he comes from a 
        # reputed lineage
        id="Velnick Markan"
        name= _ "Velnick Markan"
        canrecruit=yes
        
        type=Drake Subjugator
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_STRONG}
        [/modifications]
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Drakes"

        {GOLD 520 640 760}
        {INCOME 22 28 36}
        # most except clasher caste (for obvious regions)
        recruit="Drake Burner, Drake Fighter, Drake Glider, Drake Smasher, Drake Smasher, Fire Drake, Drake Flare, Sky Drake, Drake Adventurer, Drake Ranger, Hurricane Drake, Drake Subjugator, Drake Flameheart, Inferno Drake"
        village_gold=1
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    # I want drakes to focus on smashers and fires so limiting the rest
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Subjugator" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Hurricane Drake" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Ranger" {ON_DIFFICULTY 3 4 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Flameheart" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Inferno Drake" {ON_DIFFICULTY 3 3 4}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Burner" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Glider" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Fighter" {ON_DIFFICULTY 2 3 3}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Flare" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Sky Drake" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Drake Adventurer" {ON_DIFFICULTY 3 4 4}}


    # Drakes
    [side]
        side=7
        controller=ai
        id="Merkush Karron"
        name= _ "Merkush Karron"
        canrecruit=yes
        
        type=Drake Blademaster
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_FEARLESS}
        [/modifications]
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Drakes"

        {GOLD 520 640 760}
        {INCOME 22 28 36}
        # most except clasher caste (for obvious regions)
        recruit="Drake Burner, Drake Fighter, Drake Glider, Drake Warrior, Drake Smasher, Fire Drake, Drake Flare, Sky Drake, Drake Adventurer, Drake Ranger, Hurricane Drake, Drake Blademaster, Drake Flameheart, Inferno Drake"
        village_gold=1
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    # I want drakes to focus on warriors and fires so limiting the rest
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Blademaster" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Hurricane Drake" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Ranger" {ON_DIFFICULTY 3 4 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Flameheart" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Inferno Drake" {ON_DIFFICULTY 3 3 4}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Burner" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Glider" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Fighter" {ON_DIFFICULTY 2 3 3}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Flare" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Sky Drake" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Drake Adventurer" {ON_DIFFICULTY 3 4 4}}

    # Drakes
    # Lord Mar'Ildian
    # Armaggeddon Drake
    [side]
        side=8
        controller=ai
        id="Mar_Ildian"
        name= _ "Lord Marâ€™Ildian"
        canrecruit=yes
        
        type=Armageddon Drake
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_DEXTROUS}
        [/modifications]
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Drakes"

        {GOLD 720 840 960}
        {INCOME 22 28 36}
        recruit="Drake Flameheart, Fire Drake, Drake Warrior, Drake Blademaster, Inferno Drake, Armageddon Drake"
        village_gold=1
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 8 12}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 8 "Armageddon Drake" 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8 "Drake Flameheart" 2}

    # do not let him to die
    {FORCE_CHANCE_TO_HIT (side=1) (id="Mar_Ildian") 0 (
        {VARIABLE_CONDITIONAL turn_number greater_than 0}
    )}

    # Drakes
    # Lord Karri Kon
    # Armageddon Drake
    [side]
        side=9
        controller=ai
        id="Karri Kon"
        name= _ "Lord Karri Kon"
        canrecruit=yes
        
        type=Armageddon Drake
        [modifications]
            {TRAIT_FEARLESS}
            {TRAIT_STRONG}
        [/modifications]
        unrenamable=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Drakes"

        {GOLD 720 840 960}
        {INCOME 22 28 36}
        # recruit the heavy ones
        recruit="Drake Flameheart, Fire Drake, Drake Warrior, Drake Blademaster, Inferno Drake, Armageddon Drake"
        village_gold=1
        village_support={ON_DIFFICULTY 4 6 8}
        {LAWFUL_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 9 12}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 "Armageddon Drake" 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 "Drake Flameheart" 2}

    # do not let him to die
    {FORCE_CHANCE_TO_HIT (side=1) (id="Karri Kon") 0 (
        {VARIABLE_CONDITIONAL turn_number greater_than 0}
    )}
    
    # Eryssa
    [side]
        side=10
        location_id=Eryssa_start_pos
        controller=ai
        canrecruit=yes
        # her surival is not relevant
        {IS_EXPENDABLE_LEADER}
        {CHARACTER_STATS_ERYSSA}

        {ELVES_LINTAIR}
        team_name=player
        user_team_name= _ "Lintair Forest"
        {FLAG_VARIANT wood-elvish}

        {GOLD 580 520 480}
        {INCOME 20 18 16}
        shroud=yes
        share_vision=all

        # no scouts
        recruit="Elvish Fighter, Elvish Archer, Elvish Shaman, Elvish Hero, Elvish Marksman, Elvish Ranger, Elvish Hero, Elvish Captain, Elvish Marshal, Elvish Sharpshooter, Elvish Avenger, Elvish Champion, Elvish Druid, Elvish Sorceress, Elvish Shyde,Wose,Elder Wose,Wose Shaman,Ancient Wose"
        {NEUTRAL_AI_PARAMS}

        # her loyal subjects
        [unit]
            side=10
            placement=leader
            {CHARACTER_STATS_ELENIA}
        [/unit]
        [unit]
            side=10
            placement=leader
            {IS_LOYAL}
            id="Silmaclya"
            name= _ "female^Silmaclya"
            gender="female"
            experience={ON_DIFFICULTY 20 30 50}
            type={ON_DIFFICULTY "Elvish Ranger" "Elvish Avenger" "Elvish Avenger"}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            side=10
            placement=leader
            {IS_LOYAL}
            id="Hithrandel"
            name= _ "Hithrandel"
            type="Elvish Marshal"
            experience={ON_DIFFICULTY 24 35 43}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
    [/side]

    # limit her usage of level 1 and level 3
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Shyde" {ON_DIFFICULTY 4 4 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Marshal" {ON_DIFFICULTY 2 2 1}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Champion" {ON_DIFFICULTY 4 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Avenger" {ON_DIFFICULTY 4 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Sharpshooter" {ON_DIFFICULTY 4 3 3}}
    # they can kill drakes easily but can also be dispatched rather fast
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Ancient Wose" 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elder Wose" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Wose Shaman" 2}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Captain" {ON_DIFFICULTY 2 1 1}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Druid" {ON_DIFFICULTY 2 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Fighter" {ON_DIFFICULTY 5 4 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Archer" {ON_DIFFICULTY 5 4 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Elvish Shaman" {ON_DIFFICULTY 4 4 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 10 "Wose" 2}

    # God Dragon Kergeom himself
    [side]
        side=11
        controller=ai
        no_leader=yes
        {DRAKES_SAURIANS_KERGEOM}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Drakes"
        {HIDDEN_TEAM}
        {NO_ECONOMY}
        {NO_RECRUITMENT}
        # the boss arena is in a neutral ToD
        {NEUTRAL_AI_PARAMS}
    [/side]

    # enemy guards, spawner side
    [side]
        side=12
        controller=ai
        no_leader=yes
        {KARRAG_LOYALISTS}
        {FLAG_VARIANT long}
        team_name=karrag
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {NO_ECONOMY}
        {NO_RECRUITMENT}
        {NEUTRAL_AI_PARAMS}
    [/side]

    # prestart
    [event]
        name=prestart

        # give Hamel his well deserved lord of all Knalga buff
        {SCENARIO_11_HAMEL_REINFORCEMENTS}

        # recall the regulars
        {RECALL "Aiglondur"}
        # weirdly enough, Stalrag (side 2 is also recalled)
        # need to accomodate him in the code
        {RECALL_LOYALS}

        # make atmosphere omnious
        {COLOR_ADJUST -25 -25 -25}

        # scenario progression counter
        # stageOne - start
        # stageTwo - Kergeom boss fight
        # stageThree - True Kergeom boss fight
        # also controls roar effect
        {VARIABLE scenario_11_stage "stageOne"}

        {VARIABLE eryssa_alive_check yes}
        {VARIABLE eryssa_friendly yes}

        {VARIABLE rune_one_active no}
        {VARIABLE rune_two_active no}
        {VARIABLE rune_three_active no}
        {VARIABLE rune_four_active no}

        # objectives
        [objectives]
            side=1
            silent=no
            [objective]
                description= _ "Confront Dragon Lord Kergeom"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL scenario_11_stage equals "stageOne"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Subdue Dragon Lord Kergeom"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL scenario_11_stage equals "stageTwo"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Destroy the Clockwok Dragon Kergeom"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL scenario_11_stage equals "stageThree"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Aiglondur"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Angras"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Hamel"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Zorfu"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}

            [note]
                description= _ "Right-Click Tallin to view Enchanting Help"
            [/note]
            [note]
                description= _ "Right-Click Angras to view Rune Descriptions"
            [/note]
            [note]
                description= _ "Avoid attacking Shrooms"
            [/note]

            [note]
                description= _ "Find some way to advance into Gom Thurim"
            [/note]
            [note]
                description= _ "Right-Click Menu commands to control Zorfu are available"
            [/note]
            [note]
                description= _ "Right-Click Menu commands to control Hamel are available"
            [/note]

            # go all out
            [gold_carryover]
                carryover_percentage=0
                bonus=no
            [/gold_carryover]
        [/objectives]

        # spawned units
        {MASKED_DWARF 4 "Dwarvish Masked Guardsman" 14 57}
        {MASKED_DWARF 4 "Dwarvish Masked Guardsman" 16 57}

        {MASKED_DWARF 4 "Dwarvish Masked Stalwart" 38 57}
        {MASKED_DWARF 4 "Dwarvish Masked Stalwart" 37 58}

        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES_VETERANS}) 61 29}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES_VETERANS}) 61 40}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES_VETERANS}) 83 40}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES_VETERANS}) 83 29}

        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 60 28}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 62 29}

        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 60 39}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 62 40}

        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 82 28}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 84 29}

        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 82 39}
        {RANDOM_SPAWN 12 ({KAL_KARTHA_MASKED_DWARVES}) 84 40}

        # shrooms
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 61 31}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 68 34}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 68 44}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 69 39}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 70 24}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 76 24}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 68 44}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 74 44}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 76 34}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 75 30}
        {RANDOM_SPAWN 12 ("Shroom,Shroom,Elder Shroom,Elder Shroom,Ancient Shroom") 83 38}

        # saurians
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 82 30}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 78 40}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 77 29}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 76 32}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 75 38}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 77 42}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 67 40}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 68 36}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 70 30}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 66 28}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 68 26}
        {RANDOM_SPAWN 12 ("Saurain Oracle,Saurian Spearthrower,Saurian Augur") 62 38}

        # Flesh Golems
        {GENERIC_UNIT 12 "Flesh Golem" 58 27}{GUARDIAN}
        {GENERIC_UNIT 12 "Flesh Golem" 58 40}{GUARDIAN}
        {GENERIC_UNIT 12 "Flesh Golem" 86 28}{GUARDIAN}
        {GENERIC_UNIT 12 "Flesh Golem" 85 41}{GUARDIAN}

        # abominations
        [random_placement]
            num_items={ON_DIFFICULTY 5 8 11}
            variable=loc
            min_distance=3
            [filter_location]
                x,y=58-86,24-45
                terrain=Uhe
                [not]
                    [filter][/filter]
                [/not]
            [/filter_location]
            [command]
                {NOTRAIT_UNIT 12 "Abomination" $loc.x $loc.y}
            [/command]
        [/random_placement]

        # cave wyrms
        [random_placement]
            num_items={ON_DIFFICULTY 5 5 6}
            variable=loc
            min_distance=3
            [filter_location]
                x,y=58-86,23-45
                terrain=Ql
                [not]
                    [filter][/filter]
                [/not]
            [/filter_location]
            [command]
                {RANDOM_SPAWN 12 ("Cave Wyrm,Cave Wyrm,Cave Wyrmlet") $loc.x $loc.y}
            [/command]
        [/random_placement]

        # scorpions
        [random_placement]
            num_items={ON_DIFFICULTY 5 8 11}
            variable=loc
            min_distance=3
            [filter_location]
                x,y=58-86,23-45
                terrain=Uue
                [not]
                    [filter][/filter]
                [/not]
            [/filter_location]
            [command]
                {RANDOM_SPAWN 12 ("Giant Scorpion,Giant Scorpling,Rock Scorpion") $loc.x $loc.y}
            [/command]
        [/random_placement]

        # clockwork berserkers
        {GENERIC_UNIT 12 "Clockwork Berserker" 67 29}{GUARDIAN}
        {GENERIC_UNIT 12 "Clockwork Berserker" 73 24}{GUARDIAN}
        {GENERIC_UNIT 12 "Clockwork Berserker" 73 31}{GUARDIAN}
        {GENERIC_UNIT 12 "Clockwork Berserker" 71 38}{GUARDIAN}
        {GENERIC_UNIT 12 "Clockwork Berserker" 71 45}{GUARDIAN}
        {GENERIC_UNIT 12 "Clockwork Berserker" 77 40}{GUARDIAN}

        # cave critters
        [random_placement]
            num_items={ON_DIFFICULTY 5 8 11}
            variable=loc
            min_distance=3
            [filter_location]
                x,y=58-86,23-45
                terrain=R*
                [not]
                    [filter][/filter]
                [/not]
            [/filter_location]
            [command]
                {RANDOM_SPAWN 12 ("Giant Ant,Giant Rat,Fire Ant") $loc.x $loc.y}
            [/command]
        [/random_placement]

        # wyverns
        {GENERIC_UNIT 12 "Wild Wyvern"  4 23}
        {GENERIC_UNIT 12 "Wild Wyvern"  6 31}
        {GENERIC_UNIT 12 "Wild Wyvern" 13 35}
        {GENERIC_UNIT 12 "Wild Wyvern"  7 41}

        {GENERIC_UNIT 12 "Wild Wyvern" 10 48}
        {GENERIC_UNIT 12 "Wild Wyvern" 37 52}
        {GENERIC_UNIT 12 "Wild Wyvern" 40 44}
        {GENERIC_UNIT 12 "Wild Wyvern" 41 32}
        {GENERIC_UNIT 12 "Wild Wyvern" 43 12}

        # lava bursts
        {LAVA_OUTBURST 44 53}
        {LAVA_OUTBURST 32 50}
        {LAVA_OUTBURST 45 47}
        {LAVA_OUTBURST 31 46}

        {LAVA_OUTBURST 42 39}
        {LAVA_OUTBURST 32 38}

        {LAVA_OUTBURST 33 33}
        {LAVA_OUTBURST 41 29}

        {LAVA_OUTBURST 43 23}
        {LAVA_OUTBURST 46 16}

        {LAVA_OUTBURST 44  8}
        {LAVA_OUTBURST 32 10}
        {LAVA_OUTBURST 24  8}
        {LAVA_OUTBURST 12  9}
        {LAVA_OUTBURST  3 12}
        {LAVA_OUTBURST  2 21}
        {LAVA_OUTBURST  8 27}

        {LAVA_OUTBURST 11 30}
        {LAVA_OUTBURST 17 32}
        {LAVA_OUTBURST  3 37}
        {LAVA_OUTBURST 12 44}
        {LAVA_OUTBURST 44  8}
        {LAVA_OUTBURST  4 42}
        {LAVA_OUTBURST  9 52}

        # optimise AI with MAI
        {FAST_MAI_ADD 2}
        {FAST_MAI_ADD 3}
        {FAST_MAI_ADD 4}
        {FAST_MAI_ADD 5}
        {FAST_MAI_ADD 6}
        {FAST_MAI_ADD 7}
        {FAST_MAI_ADD 8}
        {FAST_MAI_ADD 9}
        {FAST_MAI_ADD 10}

        # further optimisations

        # programmed AI for elves
        # stay in forests and exploit that 70% Defence
        {HEALER_SUPPORT_MAI 10 add (
            [filter]
                type=Elvish Shaman,Elvish Druid,Elvish Shyde
            [/filter]
        ) () 0.30}

        [micro_ai]
            side=10
            ai_type=lurkers
            action=add

            [filter]
                type_adv_tree=Wose,Wose Shaman,Elvish Ranger
            [/filter]
            [filter_location]
                terrain=*^F*
            [/filter_location]
            [filter_location_wander]
                terrain=*^F*
            [/filter_location_wander]
            ca_score=400000
        [/micro_ai]

        {ZONE_GUARDIAN_MAI 10 add (
            [filter]
                side=10
                canrecruit=no
                [not]
                    type_adv_tree=Wose,Wose Shaman,Elvish Ranger
                [/not]
            [/filter]
        ) (
            [filter_location]
                x=32-47
                y=58-66
            [/filter_location]
        ) (
            ca_score=350000
        )}

        # saurians
        {HEALER_SUPPORT_MAI 5 add (
            [filter]
                type=Saurian Augur,Saurian Soothsayer,Saurian Seer
            [/filter]
        ) () 0.30}

        # dwarves (Hamel)
        # do not let him expose units in poor defence
        # where drakes can pick them easily
        {ZONE_GUARDIAN_MAI 3 add (
            [filter]
                side=3
                canrecruit=no
            [/filter]
        ) (
            [filter_location]
                x=1-19
                y=54-66
            [/filter_location]
        ) (
            ca_score=350000
        )}

        # drakes
        # make 2 of the 4 drake sides focus aggressively on the allies
        # other sides are supposed to provide hindrance
        # for the player and zorfu
        {ZONE_GUARDIAN_MAI 8 add (
            [filter]
                side=8
                canrecruit=no
            [/filter]
        ) (
            [filter_location]
                x=1-19
                y=54-66
            [/filter_location]
        ) (
            ca_score=350000
        )}
        {ZONE_GUARDIAN_MAI 9 add (
            [filter]
                side=9
                canrecruit=no
            [/filter]
        ) (
            [filter_location]
                x=32-47
                y=58-66
            [/filter_location]
        ) (
            ca_score=350000
        )}

        # tunnels
        [tunnel]
            id=tunnel_passage_A
            [filter]
                side=1,2,3
            [/filter]

            [source]
                x=15
                y=54
            [/source]

            [target]
                x,y=67,38
            [/target]

            bidirectional=yes
            always_visible=yes
        [/tunnel]

        [tunnel]
            id=tunnel_passage_B
            [filter]
                side=1,2,3
            [/filter]

            [source]
                x=37
                y=57
            [/source]

            [target]
                x,y=77,37
            [/target]

            bidirectional=yes
            always_visible=yes
        [/tunnel]
    [/event]

    {AI_CONTROLLER_ALLOW_MOVEMENT_CONTROL Zorfu 2}
    {AI_CONTROLLER_ALLOW_MOVEMENT_CONTROL Hamel 3}
    
    {SETUP_BRAZIERS}
    {SETUP_CAMPFIRES}

    # aesethetics
    [event]
        name="new turn"
        first_time_only=no

        [filter_condition]
            [lua]
                code=<<
                    return (wml.variables["turn_number"]%5 == 0)
                >>
            [/lua]
            # will play ever 5 turns...
            # until the special condition is met
            [and]
                {VARIABLE_CONDITIONAL scenario_11_stage not_equals "stageThree"}
            [/and]
        [/filter_condition]

        # hail Lord Kergeom, hapless fools!
        [sound]
            name=dragon-roar.ogg
        [/sound]
    [/event]

    # runes
    # speed
    {PLACE_SPEED_RUNE 27 50}
    {PLACE_SPEED_RUNE 31 55}
    {PLACE_SPEED_RUNE 21 49}
    {PLACE_SPEED_RUNE 22 45}
    {PLACE_SPEED_RUNE 20 40}
    {PLACE_SPEED_RUNE 22 35}
    {PLACE_SPEED_RUNE 27 33}
    {PLACE_SPEED_RUNE 22 32}

    # heal
    # cold damage
    # fire damage
    # teleportation
    # unlock
    # death runes


    # start event

    {PLACE_IMAGE "scenery/trapdoor.png" 15 54}
    {PLACE_IMAGE "scenery/stairs.png" 67 38}

    {PLACE_IMAGE "scenery/trapdoor.png" 37 57}
    {PLACE_IMAGE "scenery/stairs.png" 77 37}

    # wyrm spawner
    [event]
        name=turn end
        first_time_only=no
        [filter_condition]
            [lua]
                #ifdef EASY
                code=<< return (wml.variables["turn_number"] % 7 == 0) >>
                #endif
                #ifdef NORMAL
                code=<< return (wml.variables["turn_number"] % 6 == 0) >>
                #endif
                #ifdef HARD
                code=<< return (wml.variables["turn_number"] % 4 == 0) >>
                #endif
            [/lua]
        [/filter_condition]

        {SCATTER_UNITS {ON_DIFFICULTY 11 14 17} "Cave Wyrm,,Cave Wyrmlet" 8 (
            x=1-46
            y=8-53
            terrain=Mv
        ) (side=12)}
    [/event]

    # fire guardian spawner
    [event]
        name=turn end
        first_time_only=no
        [filter_condition]
            [lua]
                #ifdef EASY
                code=<< return (wml.variables["turn_number"] % 6 == 0) >>
                #endif
                #ifdef NORMAL
                code=<< return (wml.variables["turn_number"] % 5 == 0) >>
                #endif
                #ifdef HARD
                code=<< return (wml.variables["turn_number"] % 4 == 0) >>
                #endif
            [/lua]
        [/filter_condition]

        # 75% Fire Guardian, 25% Fire Wraith
        {SCATTER_UNITS {ON_DIFFICULTY 11 14 17} "Fire Guardian, Fire Wraith, Fire Guardian,Fire Guardian" 8 (
            x=1-46
            y=8-53
            terrain=Ql*,Mv
        ) (side=12)}
    [/event]

    # if elenia dies,
    # elves hate you
    [event]
        name="last breath"
        [filter]
            id="Elenia"
        [/filter]

        {SIMPLE_MSG Elenia ( _ "Farewell, my beloved sister!")}
        {SIMPLE_MSG Eryssa ( _ "Noooo!")}
    [/event]

    [event]
        name="die"
        [filter]
            id="Elenia"
        [/filter]

        {VARIABLE eryssa_friendly no}

        {SIMPLE_MSG Eryssa ( _ "<i>(teary eyes)</i> My sister...taken from me...")}

        {SIMPLE_MSG Eryssa ( _ "Elves of the Lins-Elen, dispatch any foe you see! I don't care if it's a dwarf, human, drake or lizard!")}

        [modify_side]
            side=10
            team_name=lintair
        [/modify_side]
    [/event]

    # eryssa death event
    [event]
        name="last breath"
        [filter]
            id="Eryssa"
        [/filter]

        {VARIABLE eryssa_alive_check no}

        {SIMPLE_MSG Eryssa ( _ "The Lins-Elen must not perish!")}
    [/event]

    # clan withervein buffing
    [event]
        name=recruit,recall
        first_time_only=no
        # counts like 9 units here
        [filter]
            side=2
            type_adv_tree=Orcish Grunt,Orcish Archer,Goblin Spearman
        [/filter]

        [object]
            silent=yes
            duration=forever
            [filter]
                x,y=$x1,$y1
            [/filter]

            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_WITHERVEIN}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                range=melee
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_POISON}
                    {WEAPON_SPECIAL_SLOW}
                [/set_specials]
            [/effect]
        [/object]
    [/event]
    [event]
        name=recruit,recall
        first_time_only=no
        # seperate script for the Assassin/slayer/nightblade
        [filter]
            side=2
            type_adv_tree=Orcish Assassin
        [/filter]

        [object]
            silent=yes
            duration=forever
            [filter]
                x,y=$x1,$y1
            [/filter]

            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_WITHERVEIN}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                range=melee
                type=blade
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_POISON}
                    {WEAPON_SPECIAL_SLOW}
                [/set_specials]
            [/effect]
        [/object]
    [/event]

    # leaders join fights
    {LEADER_JOINS_BATTLE 4}
    {RENAME_MASKED_DWARVES 4,12}

    # some items
    {WITHERVEIN_POISON_POTION 25 65}
    {HEAL_POTION_BACKPACK 71 25}

    # Setting: Now volcanic peak of Gom Thurim
    # Fight Kergeom in huge battle

    {HERO_DEATH_EVENTS_ALL}
[/scenario]
