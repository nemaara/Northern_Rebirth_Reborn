#textdomain wesnoth-nrr

[scenario]
    id=02_Ancient_Catacombs
    name= _ "Ancient Catacombs"
    map_file=02_Ancient_Catacombs.map
    turns=unlimited
    next_scenario=03_The_Coalition
    victory_when_enemies_defeated=no
    {XP_MODIFIER_NRR}

    {UNDERGROUND}

    {STORY_TEXT_S02}

    # Tallin side
    [side]
        side=1
        controller=human
        {CHARACTER_STATS_TALLIN}
        {FLAG_VARIANT6 ragged}
        team_name="player"
        user_team_name= _ "Adventurer"
        shroud=yes
        fog=yes
        share_vision=all
        {NO_ECONOMY}
        {NO_RECRUITMENT}
    [/side]

    # Masked Dwarves
    [side]
        side=2
        controller=ai
        id="Trithdrol"
        name= _ "Masked Dwarf"
        type="Dwarvish Masked Sentinel"
        {KARRAG_LOYALISTS}
        {FLAG_VARIANT knalgan}
        canrecruit=yes
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_HEALTHY}
        [/modifications]
        team_name=masked_dwarves,fungus1
        user_team_name= _ "Masked Dwarves"
        {HIDDEN_TEAM}
        {GOLD 120 150 220}
        {INCOME 4 8 12}
        village_gold=0
        recruit="Dwarvish Masked Fighter, Dwarvish Masked Thunderer, Dwarvish Masked Guardsman, Dwarvish Masked Ulfserker, Dwarvish Masked Stalwart, Dwarvish Masked Steelclad"

        {NEUTRAL_AI_PARAMS}
        [ai]
            passive_leader=yes
        [/ai]
    [/side]

    {STARTING_VILLAGES 2 12}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Stalwart" {ON_DIFFICULTY 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Steelclad" {ON_DIFFICULTY 1 1 2}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Ulfserker" {ON_DIFFICULTY 2 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Guardsman" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Thunderer" {ON_DIFFICULTY 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Masked Fighter" {ON_DIFFICULTY 2 3 5}}

    # Trolls
    [side]
        side=3
        controller=ai
        id="Grumph"
        name= _ "Grumph"
        type="Great Troll"
        color=orange
        {FLAG_VARIANT6 ragged}
        canrecruit=yes
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_FEARLESS}
        [/modifications]
        team_name=trolls,fungus2
        user_team_name= _ "Trolls"
        {HIDDEN_TEAM}
        {GOLD 120 150 220}
        {INCOME 4 8 12}
        village_gold=0
        recruit="Troll, Troll Whelp, Troll Rocklobber, Troll Shaman, Troll Hero"

        {CHAOTIC_AI_PARAMS}
    [/side]

    {STARTING_VILLAGES 3 8}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Hero" 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Shaman" {ON_DIFFICULTY 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Rocklobber" {ON_DIFFICULTY 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll" {ON_DIFFICULTY 2 3 3}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Whelp" {ON_DIFFICULTY 4 4 6}}

    # Saurians
    [side]
        side=4
        controller=ai
        id="Lazki"
        name= _ "Lazki"
        type="Saurian Javelineer"
        color=white
        {FLAG_VARIANT6 ragged}
        canrecruit=yes
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_QUICK}
        [/modifications]
        team_name=saurians,fungus3
        user_team_name= _ "Saurians"
        {HIDDEN_TEAM}
        {GOLD 120 150 220}
        {INCOME 4 8 12}
        village_gold=0
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Ambusher, Saurian Spearthrower, Saurian Oracle, Saurian Soothsayer"

        {CHAOTIC_AI_PARAMS}
        [ai]
            [micro_ai]
                side=4
                ai_type=healer_support
                action=add
                [filter]
                    type="Saurian Soothsayer"
                [/filter]
                aggression=0
            [/micro_ai]
        [/ai]
    [/side]

    {STARTING_VILLAGES 4 8}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Ambusher" {ON_DIFFICULTY 3 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Spearthrower" {ON_DIFFICULTY 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Oracle" {ON_DIFFICULTY 2 3 3}}
    # limit healer
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Soothsayer" {ON_DIFFICULTY 2 2 2}}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Augur" {ON_DIFFICULTY 3 5 6}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Saurian Skirmisher" {ON_DIFFICULTY 3 5 5}}

    # Four Monster Sides
    # Each has distinct micro AIs
    # regulating different fauna found here
    # Monster Side
    [side]
        side=5
        controller=ai
        team_name=monsters,fungus4
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        # unreachable leader
        id="Earth_Daemon"
        generate_name=yes
        type="Greater Earth Daemon"
        canrecruit=yes
        {GOLD 40 60 100}
        {INCOME 8 12 16}
        recruit="Cave Wyrm, Cave Wyrmlet"
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # any higher than this and these actually may be enough to
    # wreck your party
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Cave Wyrm" {ON_DIFFICULTY 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Cave Wyrmlet" {ON_DIFFICULTY 2 2 3}}

    # Monster Side
    [side]
        side=6
        controller=ai
        team_name=monsters,fungus
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # Monster Side
    [side]
        side=7
        controller=ai
        team_name=monsters,fungus
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # Monster Side
    [side]
        side=8
        controller=ai
        team_name=monsters,fungus4
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # Clockwork Side
    [side]
        side=9
        controller=ai
        team_name=clockwork
        user_team_name= _ "Clockwork"
        {HIDDEN_TEAM}
        {FLAG_VARIANT knalgan}
        {KARRAG_LOYALISTS}
        no_leader=yes
        {NO_ECONOMY}
        {NEUTRAL_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]

        # place boss unit
        [unit]
            x,y=16,4
            side=9
            {IS_HERO}
            type="Clockwork Berserker"
            id="Clockwork_Fury"
            name= _ "Fury"
            hitpoints=300
            max_hitpoints=300
        [/unit]
    [/side]

    # Giant Fungus Side
    [side]
        side=10
        controller=ai
        team_name=monsters,fungus1,fungus2,fungus3,fungus4
        user_team_name= _ "Fungus"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # More Monster Side
    # mostly for the big animals here
    [side]
        side=11
        controller=ai
        team_name=monsters,fungus
        user_team_name= _ "Monsters"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # Lurker MAI specific Saurian side
    [side]
        side=12
        controller=ai
        team_name=monsters,fungus
        user_team_name= _ "Lizard Lurkers"
        {HIDDEN_TEAM}
        {FLAG_VARIANT6 ragged}
        {MONSTER_SIDE}
        no_leader=yes
        {NO_ECONOMY}
        {CHAOTIC_AI_PARAMS}
        [ai]
            village_value=0
            [avoid]
                terrain=*^V*
            [/avoid]
        [/ai]
    [/side]

    # Setting: catacombs
    # Tallin and Zorfu explore, discover an ancient grimoire and masked dwarves as well as a steam powered automaton they are forced to flee

    # decorate abandoned lab
    {PLACE_IMAGE "scenery/bookshelf-fullSW.png" 12 3}
    {PLACE_IMAGE "scenery/bookshelf-fullSW.png" 13 4}
    {PLACE_IMAGE "scenery/bookshelf-broken.png" 10 4}

    {PLACE_IMAGE "scenery/bookshelf-full.png" 11 4}

    {PLACE_IMAGE "scenery/bookshelf-broken.png~FL(horizontal)" 18 5}
    {PLACE_IMAGE "scenery/bookshelf-broken2.png~FL(horizontal)" 19 6}
    {PLACE_IMAGE "scenery/bookshelf-less-full.png~FL(horizontal)" 23 8}
    {PLACE_IMAGE "scenery/bookshelf-fullSW.png" 24 8}

    {PLACE_IMAGE "scenery/barrel1.png" 10 5}
    {PLACE_IMAGE "scenery/barrel2.png" 20 10}

    {PLACE_IMAGE "scenery/barrel3.png" 17 6}

    {PLACE_IMAGE "items/cloak-green.png" 21 10}
    {PLACE_IMAGE "items/potion-grey.png" 18  7}

    {PLACE_IMAGE "items/anvil.png" 17  8}

    [event]
        name=prestart

        # define "outside"
        [store_locations]
            x=33-45
            y=61-67
            terrain=Mm^Xm,Hh*^*,Mm,G*^*,Rd,Md^Xm,Md
            variable=surface_hexes
        [/store_locations]

        [time_area]
            find_in=surface_hexes
            {DEFAULT_SCHEDULE}
        [/time_area]

        {CLEAR_VARIABLE surface_hexes}

        # make atmosphere omnious
        {COLOR_ADJUST -25 -25 -25}

        # recall Tallin's party
        {RECALL_LOYALS}

        # give Tallin and co weapons
        [transform_unit]
            id=Tallin
            transform_to=Footpad
        [/transform_unit]
        [transform_unit]
            type=Footpad Custom
            transform_to=Footpad
        [/transform_unit]

        # make enemies fight in a single area
        [micro_ai]
            side=2
            ai_type=zone_guardian
            action=add

            [filter]
                side=2
                canrecruit=no
            [/filter]
            [filter_location]
                x = 18-36
                y = 18-27
                terrain=U*^*
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=zone_guardian
            action=add

            [filter]
                side=3
                canrecruit=no
            [/filter]
            [filter_location]
                x = 18-36
                y = 18-27
                terrain=U*^*
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=zone_guardian
            action=add

            [filter]
                side=4
                canrecruit=no
            [/filter]
            [filter_location]
                x = 18-36
                y = 18-27
                terrain=U*^*
            [/filter_location]
        [/micro_ai]

        # scenario progress variable
        {VARIABLE S02_progression "stageOne"}

        {VARIABLE potion_x 0}
        {VARIABLE potion_y 0}

        # StageOne - Explore
        # StageTwo - Dart into the Lab
        # StageThree - Look Around the Lab
        # StageFour - Tallin takes Grimoire
        # StageFive - Escape

        # objectives
        [objectives]
            side=1
            silent=no
            [objective]
                description= _ "Explore deeper into the Catacombs"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression equals "stageOne"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Evade the Combatants"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression equals "stageTwo"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Look Around the abandoned lab"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression equals "stageThree"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Tallin takes the Grimoire"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression equals "stageFour"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Escape with Tallin and Zorfu"
                condition="win"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression equals "stageFive"}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Zorfu"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Gruk"
                condition="lose"
                [show_if]
                    {VARIABLE_CONDITIONAL S02_progression not_equals "stageFive"}
                [/show_if]
            [/objective]
            {TURNS_RUN_OUT}

            [note]
                description= _ "No recruitment available"
            [/note]
            [note]
                description= _ "Avoid attacking Shrooms"
            [/note]
        [/objectives]

        # Scatter shrooms
        {SCATTER_UNITS 50 ("Shroom, Elder Shroom, Elder Shroom, Elder Shroom, Ancient Shroom, Ancient Shroom") 3 (
            {EVERYWHERE}
            terrain=*^Tf*

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=10
            generate_name=yes
            random_traits=yes
            ai_special=guardian
            upkeep=0
        )}

        # Scatter cave ambushing mobs
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 33 64}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 41 60}

        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 11 64}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 20 52}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  2 61}

        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  4 64}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  4 62}

        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  2 51}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  9 52}

        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 11 46}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon"  5 35}
        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 12 39}

        {RANDOM_SPAWN 8 "Giant Scorpling,Giant Scorpion,Lesser Earth Daemon,Earth Daemon" 21 33}

        # Tentacles of the Deep
        {GENERIC_UNIT 7 "Tentacle of the Deep"  9 33}{GUARDIAN}
        {GENERIC_UNIT 7 "Tentacle of the Deep" 11 33}{GUARDIAN}
        {GENERIC_UNIT 7 "Tentacle of the Deep" 12 37}{GUARDIAN}
        {GENERIC_UNIT 7 "Tentacle of the Deep" 13 36}{GUARDIAN}

        # water serpent
        {GENERIC_UNIT 7 "Water Serpent"  4 39}{GUARDIAN}

        # mudcrawlers
        {GENERIC_UNIT 7 "Giant Mudcrawler" 3 44}{GUARDIAN}
        {GENERIC_UNIT 7 "Giant Mudcrawler" 6 44}{GUARDIAN}

        {GENERIC_UNIT 7 "Mudcrawler" 5 46}{GUARDIAN}
        {GENERIC_UNIT 7 "Mudcrawler" 4 47}{GUARDIAN}

        {GENERIC_UNIT 7 "Mudcrawler" 5 49}{GUARDIAN}

        # big monster - trapped behind door
        {RANDOM_SPAWN 11 "Greater Earth Daemon, Greater Earth Daemon, Giant Spider, Cave Bear, Cave Bear" 23 14}
        {RANDOM_SPAWN 11 "Greater Earth Daemon, Greater Earth Daemon, Giant Spider, Cave Bear, Cave Bear" 25 15}
        {RANDOM_SPAWN 11 "Greater Earth Daemon, Greater Earth Daemon, Giant Spider, Cave Bear, Cave Bear" 24 16}

        # Mr Bear
        [unit]
            side=11
            id=Bear
            name= _ "Big Boi"
            type="Cave Bear"
            x,y=16,53
            {PASSABLE_CHECK}
            {IS_HERO}
            [modifications]
                {TRAIT_HEALTHY}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [micro_ai]
            side=11
            ai_type=big_animals
            action=add

            [filter]
                id=Bear
            [/filter]
            [avoid_unit]
                type=Giant Spider
            [/avoid_unit]
            [filter_location]
                x= 9-17
                y=52-55
            [/filter_location]
        [/micro_ai]

        # Wolves
        {GENERIC_UNIT 6 "Great Wolf" 36 49}
        {GENERIC_UNIT 6 "Wolf" 35 51}

        {GENERIC_UNIT 6 "Wolf" 38 55}
        {GENERIC_UNIT 6 "Wolf" 40 56}

        {GENERIC_UNIT 6 "Wolf" 34 51}

        [micro_ai]
            side=6
            ai_type=zone_guardian
            action=add

            [filter]
                side=6
                canrecruit=no
                type=Wolf,Great Wolf
            [/filter]
            [filter_location]
                x,y=35-40,48-57
            [/filter_location]
        [/micro_ai]

        # Fire Guardian Chambers

        # Chamber 1
        {GENERIC_UNIT 6 "Fire Guardian" 17 62}
        {GENERIC_UNIT 6 "Fire Guardian" 24 63}
        {GENERIC_UNIT 6 "Fire Guardian" 21 61}

        {GENERIC_UNIT 6 "Fire Wraith" 29 63}

        # Chamber 2
        {GENERIC_UNIT 6 "Fire Guardian" 16 40}
        {GENERIC_UNIT 6 "Fire Guardian" 21 37}
        {GENERIC_UNIT 6 "Fire Wraith" 24 39}
        {GENERIC_UNIT 6 "Fire Guardian" 26 36}

        [micro_ai]
            side=6
            ai_type=zone_guardian
            action=add

            [filter]
                side=6
                canrecruit=no
                type=Fire Guardian,Fire Wraith
            [/filter]
            [filter_location]
                x=17-29,16-26
                y=58-64,36-41
            [/filter_location]
        [/micro_ai]

        # Lurkers
        {GENERIC_UNIT 12 "Saurian Skirmisher"  7 50}
        {GENERIC_UNIT 12 "Saurian Skirmisher" 13 49}
        {GENERIC_UNIT 12 "Saurian Skirmisher" 19 49}
        {GENERIC_UNIT 12 "Saurian Skirmisher"  7 50}
        {GENERIC_UNIT 12 "Saurian Skirmisher" 24 51}
        {GENERIC_UNIT 12 "Saurian Augur" 29 52}

        [micro_ai]
            side=12
            ai_type=lurkers
            action=add

            [filter]
                type=Saurian Skirmisher,Saurian Augur
            [/filter]
            [filter_location]
                terrain=S*
            [/filter_location]
            [filter_location_wander]
                terrain=S*
            [/filter_location_wander]
        [/micro_ai]

        # sprinkle map with weak units
        {SCATTER_UNITS {ON_DIFFICULTY 18 22 26} ("Giant Rat, Giant Rat, Giant Ant, Giant Ant, Giant Ant, Fire Ant") 3 (
            x= 2-26
            y=31-57
            terrain=Uu

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=8
            generate_name=yes
            random_traits=yes
        )}

        # micro AI to regulate this units
        # They should not attack you
        # but rather run away
        [micro_ai]
            side=8
            ai_type=coward
            action=add

            [filter]
                type=Giant Rat,Giant Ant,Fire Ant
            [/filter]
            distance=5
        [/micro_ai]

        # tunnel for wyrms
        [tunnel]
            [filter]
                side=5
                canrecruit=no
            [/filter]
            [source]
                x=26,28
                y=39,41
            [/source]
            [target]
                x=22, 6, 7, 1
                y=46,32,56,55
            [/target]
            bidirectional=no
        [/tunnel]

        # micro AI for wyrms
        [micro_ai]
            side=5
            ai_type=zone_guardian
            action=add

            [filter]
                side=5
                canrecruit=no
                type=Cave Wyrm,Cave Wyrmlet
            [/filter]
            [filter_location]
                x= 1-30,18-36
                y=32-53,19-31
            [/filter_location]
        [/micro_ai]
    [/event]

    [event]
        name=start

        [message]
            x,y=43,65
            message= _ "Hey boss, you sure going in these caves is a good idea?"
        [/message]
        [message]
            speaker=Gruk
            #po: slavers refers to orcish slavers like the ones from S1
            message= _ "You are the one who spotted that party of slavers eyeing us. Unless you want to go fight them, it would be better for us to avoid conflict and take shelter."
        [/message]
        [message]
            x,y=43,65
            message= _ "Good point, boss."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "Gruk is right, but I got a weird feeling about these caves."
        [/message]
        [message]
            speaker=Gruk
            message= _ "As do I, but it is the better option for now. Pinkskin, you are faster than the rest of us, so whatever scouting you can do will be helpful. The rest of us, stay as a group and stay on guard."
        [/message]
        [message]
            speaker=Tallin
            message= _ "Sure thing."
        [/message]
    [/event]

    # traps
    {COLLAPSE_WALL_TRAP_EVENT 39 61 40 60}
    {COLLAPSE_WALL_TRAP_EVENT 35 62 34 62}

    {COLLAPSE_WALL_TRAP_EVENT 10 61 11 62}
    {COLLAPSE_WALL_TRAP_EVENT  4 59  3 60}

    {COLLAPSE_WALL_TRAP_EVENT  2 61  3 62}
    {COLLAPSE_WALL_TRAP_EVENT  4 52  3 52}
    {COLLAPSE_WALL_TRAP_EVENT  7 52  8 51}

    {COLLAPSE_WALL_TRAP_EVENT 11 48 10 47}
    {COLLAPSE_WALL_TRAP_EVENT 11 50 10 50}
    {COLLAPSE_WALL_TRAP_EVENT 22 51 21 52}

    {COLLAPSE_WALL_TRAP_EVENT 12 44 11 45}
    {COLLAPSE_WALL_TRAP_EVENT 11 41 12 40}
    {COLLAPSE_WALL_TRAP_EVENT 11 38 12 38}

    {COLLAPSE_WALL_TRAP_EVENT  7 36  6 35}

    {COLLAPSE_WALL_TRAP_EVENT 18 34 19 34}
    {COLLAPSE_WALL_TRAP_EVENT 23 34 22 34}

    # stage two progression check
    [event]
        name="moveto"
        [filter]
            id="Tallin"
            x="23,24,25,26"
            y="33-35,31-35,31-35,31-33"
        [/filter]

        # TODO: some sound effects about enemies clashing
        # like..a troll smashing hammer
        # saurian cries
        # dwarven thundersticks
        # something to cement in the mood of a battle ongoing

        # some dialogue by party members to prefer evasive tactics

        {VARIABLE S02_progression "stageTwo"}

        # update player
        [show_objectives]
        [/show_objectives]
    [/event]

    # stage three progression check
    [event]
        name="moveto"
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [filter_condition]
            [have_unit]
                id="Tallin"
                x="10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                y="4-5,4-6,3-6,4-7,5-7,6-8,6-8,6-9,5-9,6-10,6-10,7-10,7-9,8-9,8"
            [/have_unit]
            [and]
                [have_unit]
                    id="Zorfu"
                    x="10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                    y="4-5,4-6,3-6,4-7,5-7,6-8,6-8,6-9,5-9,6-10,6-10,7-10,7-9,8-9,8"
                [/have_unit]
            [/and]
            [and]
                [have_unit]
                    id="Gruk"
                    x="10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                    y="4-5,4-6,3-6,4-7,5-7,6-8,6-8,6-9,5-9,6-10,6-10,7-10,7-9,8-9,8"
                [/have_unit]
            [/and]
            [and]
                {VARIABLE_CONDITIONAL S02_progression equals "stageTwo"}
            [/and]
        [/filter_condition]

        # some dialogue about locking up the lab
        # to prevent does pursuing
        {SCROLL_TO 17 10}
        [sound]
            name=flail.ogg
        [/sound]
        [terrain]
            x=17,18
            y=10,10
            terrain=Isa^Pr\
        [/terrain]
        {SCROLL_TO 23 10}
        [sound]
            name=flail.ogg
        [/sound]
        [terrain]
            x=23,24
            y=10, 9
            terrain=Isa^Pr/
        [/terrain]

        # open this northern exit
        [sound]
            name=flail.ogg
        [/sound]
        [terrain]
            x=21,22
            y= 6, 6
            terrain=Isa^Pr\o
        [/terrain]

        # kill any left outside
        # if you left any outside...
        # it's on you
        [kill]
            side=1
            [not]
                x="10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                y="4-5,4-6,3-6,4-7,5-7,6-8,6-8,6-9,5-9,6-10,6-10,7-10,7-9,8-9,8"
            [/not]
        [/kill]

        # place shroud at the rest of the map
        [place_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x=1-44
            y=11-67
        [/place_shroud]
        [redraw]
        [/redraw]

        # some dialogue about
        # we can look around in peace now

        {VARIABLE S02_progression "stageThree"}

        # update player
        [show_objectives]
        [/show_objectives]
    [/event]

    # place grimoire
    {PLACE_IMAGE "items/book5.png" 4 3}

    # side 1 sees the grimoire
    [event]
        name=moveto
        [filter]
            id="Tallin"
            x=4-5
            y=4-6,4-7
        [/filter]

        # some dialogue between Tallin and Zorfu

        {VARIABLE S02_progression "stageFour"}
    [/event]

    # Tallin takes Grimoire
    [event]
        name=moveto
        [filter]
            id="Tallin"
            x=4
            y=3
        [/filter]
        [filter_condition]
            {VARIABLE_CONDITIONAL S02_progression equals "stageFour"}
        [/filter_condition]

        {REMOVE_IMAGE 4 3}

        # some dialogue between Tallin and Zorfu

        {VARIABLE S02_progression "stageFive"}

        # just do a scripted cutscene
        [fire_event]
            name=cutscene_S02_end
        [/fire_event]
    [/event]

    [event]
        name=cutscene_S02_end

        {MOVE_UNIT (id="Tallin") 11 6}
        {MOVE_UNIT (id="Zorfu") 12 6}

        # scripted cutscene
        # that shows the encounter with the boss and Tallin and Zorfu escaping
        # while the rest of Clan Withervein stays behind to fight off the
        # unkillable berserking clockwork machina

        {SCROLL_TO 18 6}
        [sound]
            name=flail.ogg
        [/sound]
        [terrain]
            x=15
            y=5
            terrain=Isa^Pr\o
        [/terrain]
        [sound]
            name=flail.ogg
        [/sound]
        [terrain]
            x=17
            y=5
            terrain=Isa^Pr/o
        [/terrain]

        {MOVE_UNIT (id="Clockwork_Fury") 18 6}

        # farewell last clan withervein leader
        {MOVE_UNIT (id="Gruk") 19 7}

        # let Tallin and Zorfu escape
        {MOVE_UNIT (id="Tallin") 26 1}
        {MOVE_UNIT (id="Zorfu") 27 1}

        [kill]
            side=1
            [not]
                id="Tallin"
            [/not]
            [not]
                id="Zorfu"
            [/not]
            # footpad/outlaws/fugitives
            [not]
                race=human
            [/not]
            animate=no
            fire_event=no
        [/kill]

        {CLEAR_VARIABLE S02_progression,potion_x,potion_y}

        # there is no need to show gold
        # carried over or bonus
        # since you get nothing
        {ENDLEVEL_CONTINUE_WITH_REPLAY}
    [/event]

    # ring special item
    {PICKUPPABLE_ITEM ring_hp 33 49 (
        side=1
        [not]
            race=goblin
        [/not]
        [not]
            race=wolf
        [/not]
    ) items/ring-red.png _"$unit.name finds a reddish ring. Should $unit.name pick it up?"
    _"ring_hp^Take it"
    _"ring_hp^Leave it"
    _"Only an orc or a human can take this item!" (
        [object]
            name= _ "Ring of Endurance"
            image=items/ring-red.png
            description= _ "This ring grants the wearer +5 max HP!"
            duration=forever

            [effect]
                apply_to=hitpoints
                increase_total=5
                increase=5
            [/effect]
        [/object]
    )}

    # warning for trap
    [event]
        name="enter_hex"
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x=33-38
                y=51-54
            [/filter_location]
        [/filter]
        
        #TODO: add a better image of cracks at 35,50
        {SCROLL_TO 35 50}
        [delay]
            time=700
        [/delay]

        [message]
            speaker=Tallin
            message= _ "Hey, I think I see a bridge over there! It looks like there’s a ring behind it... but that bridge anchor looks really unsteady. If we wanna get that ring, looks like we’ll have to avoid stepping on that weak spot."
        [/message]
        
        [cancel_action][/cancel_action]
    [/event]

    # there's a catch
    [event]
        name="moveto"
        [filter]
            side=1
            x,y=35,50
        [/filter]

        {REMOVE_IMAGE 33 49}

        {EARTHQUAKE (
            [terrain]
                x=34,33
                y=49,49
                terrain=Qxu
            [/terrain]
            [redraw]
            [/redraw]
            # kill the unlucky fools there
            [message]
                x,y=34,49
                message= _ "Wait, nooooo!"
            [/message]
            [message]
                x,y=33,49
                message= _ "Help meeee!!"
            [/message]
            [kill]
                x=34,33
                y=49,49
                animate=yes
                fire_event=yes
            [/kill]
        )}
        
        [delay]
            time=400
        [/delay]

        [message]
            speaker=Tallin
            message= _ "Damn! I said we had to be careful!"
        [/message]
        [message]
            speaker=Gruk
            message= _ "Stay on guard! From here on out, we must be especially watchful for traps."
        [/message]
    [/event]

    # some reward for fire guardian chamber clear
    {PICKUPPABLE_ITEM ball_power 19 63 (
        side=1
        [not]
            race=goblin
        [/not]
        [not]
            race=wolf
        [/not]
    ) items/ball-magenta.png _"$unit.name finds a reddish orb. Should $unit.name pick it up?"
    _"ball_power^Take it"
    _"ball_power^Leave it"
    _"Only an orc or a human can take this item!" (
        [object]
            name= _ "Orb of Power"
            image=items/ball-magenta.png
            description= _ "This orb grants the wearer +1 attack damage!"
            duration=forever

            [effect]
                apply_to=attack
                increase_damage=1
            [/effect]
        [/object]
    )}

    # special item but it is risky getting here
    {PICKUPPABLE_ITEM talisman_ele_res  5 64 (
        side=1
        [not]
            race=goblin
        [/not]
        [not]
            race=wolf
        [/not]
    ) items/talisman-stone.png _"$unit.name finds a fancy talisman. Should $unit.name pick it up?"
    _"talisman_ele_res^Take it"
    _"talisman_ele_res^Leave it"
    _"Only an orc or a human can take this item!" (
        [object]
            name= _ "Elemental Protection"
            image=items/talisman-stone.png
            description= _ "This talisman grants its wearer 20% fire/cold/arcane resistance!"
            duration=forever

            [effect]
                apply_to=resistance
                replace=yes
                [resistance]
                    fire=80
                    cold=80
                    arcane=80
                [/resistance]
            [/effect]
        [/object]
    )}

    # seeing the water serpent
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Water Serpent
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "That serpent looks really big... and venomous."
        [/message]
    [/event]

    # special event for capturing that
    # isolate village
    # yes, it's a nasty surprise
    [event]
        name=capture
        first_time_only=yes
        [filter]
            side=1
            x,y=2,42
        [/filter]

        {RANDOM "a,b,c"}

        [switch]
            variable=random

            [case]
                value=a

                {GENERIC_UNIT 12 {ON_DIFFICULTY "Saurian Ambusher" "Saurian Ambusher" "Saurian Flanker"}  2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
                {GENERIC_UNIT 12 {ON_DIFFICULTY "Saurian Augur" "Saurian Augur" "Saurian Oracle"}  2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
            [/case]

            [case]
                value=b

                {GENERIC_UNIT 7 "Water Serpent"  2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
            [/case]

            [case]
                value=c

                {GENERIC_UNIT 7 {ON_DIFFICULTY "Mudcrawler" "Mudcrawler" "Giant Mudcrawler"} 2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
                {GENERIC_UNIT 7 {ON_DIFFICULTY "Mudcrawler" "Giant Mudcrawler" "Giant Mudcrawler"} 2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
                {GENERIC_UNIT 7 {ON_DIFFICULTY "Giant Mudcrawler" "Giant Mudcrawler" "Giant Mudcrawler"} 2 42}
                [+unit]
                    {PASSABLE_CHECK}
                [/unit]
            [/case]
        [/switch]

        {CLEAR_VARIABLE random}
        
        [if]
            [have_unit]
                id="Gruk"
                x,y=2,42
            [/have_unit]
            [then]
                [message]
                    speaker=Gruk
                    message= _ "An ambush!"
                [/message]
                [message]
                    speaker=Zorfu
                    message= _ "Quick, we have to go help Gruk!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message= _ "Help! Help, I’m being ambushed!"
                [/message]
                [message]
                    speaker=Gruk
                    message= _ "Stand fast, we are on the way!"
                [/message]
            [/else]
        [/if]
    [/event]

    # another capture event
    # for 9,55
    [event]
        name="moveto"
        first_time_only=yes

        [filter]
            side=1
            x,y=9,55
        [/filter]

        # yumi: add more dialogue here?

        {VARIABLE potion_x 10}
        {VARIABLE potion_y 54}

        {PLACE_IMAGE "items/potion-blue.png" $potion_x $potion_y}

        # connect event with this
        [event]
            name=moveto
            first_time_only=no
            id=potion_xp_event
            delayed_variable_substitution=no
            [filter]
                side=1
                x=$potion_x
                y=$potion_y
            [/filter]
            [object]
                id=potion_xp
                name= _ "Potion of Intellect"
                image=items/potion-blue.png
                duration=forever
                description= _ "The drinker requires 10% less XP to advance."
                [filter]
                    side=1
                    x=$potion_x
                    y=$potion_y
                [/filter]
                [then]
                    [remove_item]
                        x,y=$potion_x,$potion_y
                    [/remove_item]
                [/then]
                [effect]
                    apply_to=max_experience
                    increase=-10%
                [/effect]
            [/object]
        [/event]
    [/event]

    # finding big wooden door
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=1
            x,y=24,18
        [/filter]
        # 50/50 chance
        {RANDOM "open,closed"}
        [switch]
            [case]
                value=open

                # dialogue to letting it open
                [sound]
                    name=flail.ogg
                [/sound]
                [terrain]
                    x=24
                    y=17
                    terrain=Isa^Pw|o
                [/terrain]

                [redraw]
                [/redraw]

                # dialogue when you see
                # it's full of monsters
            [/case]
            [case]
                value=closed

                # dialogue to letting it stay closed
            [/case]
        [/switch]
        {CLEAR_VARIABLE random}
    [/event]

    # saurian dialogue events
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            side=12
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            #po: Hsssss is just an lizard exclamation of surprise while orcsie is just an orc
            message= _ "Hsssss?! Humanss and orcsiesss in our territory?!"
        [/message]
        [message]
            speaker=Tallin
            message= _ "Firespitters! Wait, no. The other lizards!"
        [/message]
        [message]
            speaker=Gruk
            message= _ "Saurians. Currently the lackeys for the drakes, though some clans also choose to ally themselves with us. Lizard, we must cross your territory. The way back is too dangerous—"
        [/message]
        [message]
            speaker=unit
            #po: and now Hssss is displeasure
            message= _ "Hssss, no deal, orcssie, no deal. You are ssso obviousssly too weak to be of use to usssss. You mussst leave."
        [/message]
        [message]
            speaker=Gruk
            message= _ "I am afraid we cannot do that."
        [/message]
        [message]
            speaker=unit
            message= _ "Enter and we will nourish our sssswamp with your bonessss, orcsie."
        [/message]
        [message]
            speaker=Gruk
            message= _ "That will have to be the case then."
        [/message]
    [/event]
    [event]
        name="last breath"
        first_time_only=yes
        [filter]
            side=12
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Accurssseeed orcsiesss..."
        [/message]
    [/event]

    # uh oh it's the big boi
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Cave Bear
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Grroooaaar!!"
        [/message]
        [message]
            speaker=Zorfu
            #po: they are being sarcastic
            message= _ "What a gigantic bear... Tallin, you should go and pet him."
        [/message]
        [message]
            speaker=Tallin
            message= _ "Yeah, sure man. Let me just go and get eaten. Come to think of it you probably have more fat on your bones than me, so you should volunteer to be his snack."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "Good point. Yeah, let me just go and get eaten by that big furry monster."
        [/message]
    [/event]
    [event]
        name="last breath"
        first_time_only=yes
        [filter]
            side=1
            [not]
                id=Gruk, Zorfu, Tallin
            [/not]
        [/filter]
        [filter_second]
            type=Cave Bear
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Help, help I’m being eaten!!"
        [/message]
        [message]
            speaker=Zorfu
            message= _ "You should have been more careful... I was only joking about being a bear’s snack."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Cave Bear
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "..."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "..."
        [/message]
        [message]
            speaker=Gruk
            message= _ "Stop standing there gawking like a pair of numbskulls! We should carve up his meat now while it is still fresh. This will be enough to last us for days."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "Yeah, we’ll get on it."
        [/message]
    [/event]

    # cave wyrm
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Cave Wrym, Cave Wyrmlet
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "What the devil is that creature? It also seems like a firespitter, only really misshapen."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "I am beginning to think that you see everything as a firespitter."
        [/message]
    [/event]

    # mudcrawler sighted
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Mudcrawler, Giant Mudcrawler
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Ick, the mud in this swamp is alive and moving."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Mudcrawler, Giant Mudcrawler
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Gross, now the mud got all over me."
        [/message]
    [/event]

    # fire elemental sighted
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Fire Guardian, Fire Wraith
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "Firespitters! Wait, no... these are something else?"
        [/message]
        [message]
            speaker=Gruk
            message= _ "They are beings of pure flame without flesh and with limited sentience. However, I believe they are related to the drakes in some way."
        [/message]
        [message]
            speaker=Tallin
            message= _ "Hopefully they’re not as strong."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Fire Guardian
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "I guess that thing wasn’t so hard to kill."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Fire Wraith
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "Whew, looks like we destroyed it. That was getting kinda dangerous."
        [/message]
    [/event]

    # rock dudes
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Lesser Earth Daemon, Earth Daemon
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tallin
            message= _ "Those rocks are moving! The caves themselves are alive!"
        [/message]
        [message]
            speaker=Gruk
            message= _ "It is merely an elemental. Small ones like these may arise naturally quite frequently."
        [/message]
    [/event]

    # avoid da shroomz
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Shroom, Ancient Shroom, Elder Shroom
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Zorfu
            message= _ "Blegh, giant mushrooms. Icky."
        [/message]
        [message]
            speaker=Tallin
            message= _ "Heh, thought you liked eating anything."
        [/message]
        [message]
            speaker=Zorfu
            message= _ "Almost anything. If you want to chow down on one of those, be my guest. I’ll gladly sit over here and watch you."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Elder Shroom
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Uff, that took so much to crush just a little shroom. Not worth the time at all."
        [/message]
    [/event]
    [event]
        name="die"
        first_time_only=yes
        [filter]
            type=Ancient Shroom
        [/filter]
        [filter_second]
            side=1
            [not]
                id=Zorfu, Gruk
            [/not]
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Shroooooom. (<i>chomp</i>)"
        [/message]
        [message]
            speaker=Zorfu
            message= _ "Oh you cannot be serious. Don’t tell me..."
        [/message]
        [message]
            speaker=second_unit
            message= _ "What? It tastes fine. It’s not one of those weird ones that make you hallucinate. Those are much smaller. Wanna try some?"
        [/message]
        [message]
            speaker=Zorfu
            message= _ "I would rather die, thanks."
        [/message]
    [/event]
    [event]
        name="attack_end"
        first_time_only=yes
        [filter]
            type=Shroom, Ancient Shroom, Elder Shroom
        [/filter]
        [filter_second]
            side=1
            [not]
                id=Gruk
            [/not]
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Ouch, gross! This thing launched some kind of goo at me. And I could barely even scratch it!"
        [/message]
        [message]
            speaker=Gruk
            message= _ "Then it would be best to avoid fighting these things. It is not worth the effort for so little gain."
        [/message]
    [/event]

    # event for goblin apprecation
    [event]
        name="sighted"
        first_time_only=yes
        [filter]
            type=Wolf, Great Wolf
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Gruk
            message= _ "Hrm, a pack of savage mutts. It may be possible to tame some of them if you goblins can subdue them."
        [/message]
        [message]
            race=goblin
            message= _ "Eep, we’ll do our best, boss!"
        [/message]
    [/event]

    [event]
        name="die"
        first_time_only=no
        [filter]
            type=Wolf
        [/filter]
        [filter_second]
            type="Goblin Spearman"
        [/filter_second]

        [transform_unit]
            id=$second_unit.id
            transform_to="Wolf Rider"
        [/transform_unit]

        [fire_event]
            name="wolf taming"
        [/fire_event]
    [/event]

    [event]
        name="last breath"
        first_time_only=yes
        [filter]
            type=Great Wolf
        [/filter]
        [filter_second]
            type="Goblin Spearman"
        [/filter_second]

        [message]
            speaker=Gruk
            message= _ "What a wild mutt. Put the creature down before it does more damage."
        [/message]
    [/event]

    [event]
        name="last breath"
        first_time_only=yes
        [filter]
            type=Wolf
        [/filter]
        [filter_second]
            type="Goblin Spearman"
        [/filter_second]

        [message]
            speaker=Gruk
            message= _ "Hold there. We may be able to tame this mutt. Try mounting it."
        [/message]
        [message]
            speaker=second_unit
            message= _ "On it, boss!"
        [/message]

        #TODO: play some sound effects?
        [delay]
            time=500
        [/delay]
    [/event]
    [event]
        name="wolf taming"
        first_time_only=yes

        [message]
            speaker=Gruk
            message= _ "Well done. If we can tame more of these wolves, our scouting capabilities will be greatly improved."
        [/message]
    [/event]

    # Easter Egg bonus event
    #ifdef HARD
    [event]
        name="last breath"
        first_time_only=no
        [filter]
            type=Great Wolf
        [/filter]
        [filter_second]
            type="Goblin Impaler"
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Look, I caught a big one!"
        [/message]

        [transform_unit]
            id=$second_unit
            type="Goblin Knight"
        [/transform_unit]

        [message]
            speaker=Zorfu
            #po: gobu is how orcs refer to goblins, it means something like "ones who are commanded [to obey]" but not in a derogatory way
            message= _ "Most impressive, gobu."
        [/message]
    [/event]
    #endif

    # Death event for clan withervein's last leader
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id="Gruk"
        [/filter]

        # some dialogue here
    [/event]

    [event]
        name=die
        first_time_only=yes
        [filter]
            id="Gruk"
        [/filter]

        [message]
            speaker=Zorfu
            message= _ "Nooo! We can’t go on without our leader!"
        [/message]

        [filter_condition]
            {VARIABLE_CONDITIONAL S02_progression not_equals "stageFive"}
        [/filter_condition]
        {ENDLEVEL_DEFEAT}
    [/event]

    {TALLIN_DEATH_EVENT}
    {ZORFU_DEATH_EVENT}

    {RENAME_MASKED_DWARVES 2}
[/scenario]
